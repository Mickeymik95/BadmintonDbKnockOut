<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>BWF BADMINTON SUPER SERIES FAMILY TOUR</title>
    <style>
        :root { 
            --menang: #2ecc71; 
            --kalah: #e74c3c; 
            --utama: #00d2ff; 
            --emas: #ffd700; 
            --bg: #0b0b0d; 
            --kad: #1a1a1f; 
            --ws-hijau: #25D366; 
            --garis: #333;
            --biru-nombor: #00e5ff;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); 
            color: #fff; 
            padding: 20px; 
            margin: 0; 
        }

        .main-wrapper { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-width: min-content; 
        }

        /* HEADER SECTION */
        .header-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            padding: 30px;
            border-radius: 30px;
            border-bottom: 2px solid var(--garis);
            margin-bottom: 40px;
            width: 100%;
            box-sizing: border-box;
        }

        .header-top { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            width: 100%; 
            margin-bottom: 25px; 
        }

        .logo-box img { 
            height: 95px; 
            width: 95px; 
            border-radius: 15px; 
            filter: drop-shadow(0 0 12px var(--utama)); 
        }

        .tajuk-box { text-align: center; }
        .tajuk-box h1 { 
            font-size: 2.5rem; 
            margin: 0; 
            background: linear-gradient(130deg, #00d2ff, #2ecc71, #e74c3c, #ffd700); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-weight: 900; 
            text-transform: uppercase;
        }

        .siri-tag { 
            font-size: 1.8rem; 
            color: var(--emas); 
            letter-spacing: 8px; 
            font-weight: 900; 
            display: block; 
            margin-top: 5px;
            margin-bottom: 20px;
        }

        /* ADMIN WHATSAPP GREEN SECTION */
        .admin-header-grid { 
            display: flex; 
            gap: 15px; 
            justify-content: center; 
            width: 100%; 
            flex-wrap: wrap; 
        }

        .admin-ws-card { 
            background: rgba(37, 211, 102, 0.1); 
            border: 2px solid var(--ws-hijau); 
            border-radius: 12px; 
            padding: 10px 20px; 
            text-decoration: none; 
            display: flex; 
            align-items: center; 
            gap: 12px;
            transition: 0.4s; 
            box-shadow: 0 0 15px rgba(37, 211, 102, 0.1);
        }

        .admin-ws-card:hover { 
            background: var(--ws-hijau); 
            transform: translateY(-5px); 
            box-shadow: 0 0 25px var(--ws-hijau);
        }

        .admin-ws-card:hover .ws-name, 
        .admin-ws-card:hover .ws-role { 
            color: #000; 
        }

        .ws-logo-icon { width: 22px; height: 22px; }
        .ws-name { color: #fff; font-weight: 800; font-size: 0.9rem; display: block; }
        .ws-role { color: var(--ws-hijau); font-size: 0.7rem; text-transform: uppercase; display: block; font-weight: bold; }

        /* BRACKET STYLING */
        .tournament-layout { display: flex; flex-direction: column; gap: 50px; align-items: center; }
        .laluan-row { 
            display: flex; 
            gap: 35px; 
            padding: 40px; 
            background: rgba(255,255,255,0.01); 
            border-radius: 25px; 
            border: 1px solid #222; 
            align-items: center;
        }

        .pusingan { display: flex; flex-direction: column; gap: 25px; min-width: 260px; justify-content: space-around; }
        
        .tajuk-pusingan { 
            font-size: 0.75rem; 
            font-weight: 900; 
            text-align: center; 
            padding: 10px; 
            background: #111; 
            color: var(--utama); 
            border: 1px solid #444; 
            border-radius: 8px; 
            text-transform: uppercase; 
            margin-bottom: 15px;
        }

        .kotak-perlawanan { 
            background: var(--kad); 
            border: 1px solid var(--garis); 
            border-radius: 15px; 
            overflow: hidden; 
            position: relative; 
            padding-top: 30px; 
            width: 260px; 
            transition: 0.3s;
        }

        .match-no { 
            position: absolute; 
            top: 0; left: 0; right: 0; 
            background: #25252b; 
            color: var(--biru-nombor); 
            font-size: 9px; 
            padding: 5px; 
            text-align: center; 
            font-weight: bold;
        }

        .slot-pasukan { 
            display: flex; 
            gap: 12px; 
            align-items: center; 
            padding: 10px 15px; 
            border-bottom: 1px solid #222; 
            height: 50px; 
        }

        .nama-display { 
            flex: 1; 
            font-size: 0.85rem; 
            font-weight: 700; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }

        .skor { 
            width: 40px; 
            height: 32px; 
            text-align: center; 
            background: #000; 
            border: 1px solid #444; 
            color: #fff; 
            border-radius: 6px; 
            font-weight: 900; 
            font-size: 1rem;
        }

        /* WINNER / LOSER COLORS */
        .skor-menang { background: var(--menang) !important; color: #000 !important; border: none; }
        .skor-kalah { background: var(--kalah) !important; color: #fff !important; border: none; }
        .slot-menang { background: rgba(46, 204, 113, 0.12) !important; }

        /* GRAND FINAL POSITIONING */
        .gf-container { 
            display: flex; 
            align-items: center; 
            padding-left: 50px; 
            border-left: 3px dashed #333; 
            margin-left: 15px; 
        }

        .grand-final { 
            border: 3px solid var(--emas) !important; 
            background: rgba(255, 215, 0, 0.06) !important; 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }

        /* TEAM LIST */
        .senarai-peserta-awam { 
            background: var(--kad); 
            padding: 25px; 
            border-radius: 20px; 
            margin-bottom: 50px; 
            border: 1px solid var(--garis); 
            width: 100%; 
        }

        .grid-peserta { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 15px; 
            justify-content: center; 
        }

        .kad-peserta-ringkas { 
            flex: 0 0 calc(18%); 
            min-width: 160px; 
            background: #000; 
            padding: 12px; 
            border-radius: 10px; 
            border: 1px solid #333; 
            text-align: center; 
            font-size: 0.9rem; 
            font-weight: bold;
        }

        /* ADMIN PANEL */
        #panelAdmin { 
            display: none; 
            position: fixed; 
            top: 20px; right: 20px; 
            width: 320px; 
            background: var(--kad); 
            border: 2px solid var(--utama); 
            border-radius: 20px; 
            z-index: 9999; 
            padding: 25px; 
            box-shadow: 0 0 60px #000; 
        }

        .btn-panel { 
            width: 100%; 
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-top: 10px; 
        }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="header-container">
        <div class="header-top">
            <div class="logo-box">
                <img src="logo.jpeg" onerror="this.src='https://via.placeholder.com/95'">
            </div>
            <div class="tajuk-box">
                <h1>BWF BADMINTON FAMILY TOUR</h1>
                <span class="siri-tag">SIRI II</span>
            </div>
            <div class="admin-box">
                <button onclick="toggleAdmin()" style="background:transparent; border:1px solid var(--utama); color:var(--utama); padding:8px 15px; border-radius:8px; cursor:pointer; font-weight:bold;">
                    ADMIN PANEL
                </button>
            </div>
        </div>

        <div class="admin-header-grid">
            <a href="https://wa.me/60149236577" target="_blank" class="admin-ws-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="ws-logo-icon">
                <div class="ws-text-box">
                    <span class="ws-name">Ammik</span>
                    <span class="ws-role">Teknikal & Carta</span>
                </div>
            </a>
            <a href="https://wa.me/601111639636" target="_blank" class="admin-ws-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="ws-logo-icon">
                <div class="ws-text-box">
                    <span class="ws-name">Anggan</span>
                    <span class="ws-role">Penaung & Penganjur</span>
                </div>
            </a>
            <a href="https://wa.me/601139058698" target="_blank" class="admin-ws-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="ws-logo-icon">
                <div class="ws-text-box">
                    <span class="ws-name">Banding</span>
                    <span class="ws-role">Timbalan Penganjur</span>
                </div>
            </a>
            <a href="https://wa.me/60128228860" target="_blank" class="admin-ws-card">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="ws-logo-icon">
                <div class="ws-text-box">
                    <span class="ws-name">Azis</span>
                    <span class="ws-role">Pengerusi & Perasmi</span>
                </div>
            </a>
        </div>
    </div>

    <div class="senarai-peserta-awam">
        <div id="gridPesertaAwam" class="grid-peserta"></div>
    </div>

    <div class="tournament-layout">
        <div id="barisW" class="laluan-row"></div>
        <div id="barisL" class="laluan-row"></div>
    </div>
</div>

<div id="panelAdmin">
    <span style="float:right; cursor:pointer; font-size:20px;" onclick="toggleAdmin()">√ó</span>
    <h3 style="color:var(--utama); margin-top:0;">Tournament Manager</h3>
    <div id="authBox">
        <input type="password" id="passInput" placeholder="Password Admin" style="width:100%; padding:10px; margin-bottom:10px; background:#000; border:1px solid #444; color:#fff;">
        <button class="btn-panel" style="background:var(--utama); color:#000;" onclick="checkAuth()">LOG MASUK</button>
    </div>
    <div id="controlBox" style="display:none;">
        <p style="font-size:12px;">Masukkan Jumlah Pasukan (Default 14):</p>
        <input type="number" id="inputN" value="14" style="width:100%; padding:10px; background:#000; color:#fff; border:1px solid #444;">
        <button class="btn-panel" style="background:var(--menang); color:#000;" onclick="manualJana()">JANA BRACKET</button>
        <div id="adminTeamInputs" style="margin-top:20px; max-height:300px; overflow-y:auto;"></div>
    </div>
</div>

<script>
    let nPasukan = 14;
    let p2 = 16;
    let seeds = [];
    let matchCounter = 1;

    function toggleAdmin() {
        let p = document.getElementById('panelAdmin');
        p.style.display = (p.style.display === 'block') ? 'none' : 'block';
    }

    function checkAuth() {
        if(document.getElementById('passInput').value === "admin123") {
            document.getElementById('authBox').style.display = 'none';
            document.getElementById('controlBox').style.display = 'block';
        }
    }

    function manualJana() {
        nPasukan = parseInt(document.getElementById('inputN').value);
        jana();
    }

    function updateNama(idx, val) {
        let n = val || `Pasukan ${idx + 1}`;
        document.getElementById(`awam_nama_${idx}`).innerText = n;
        
        let targetSlots = document.querySelectorAll(`[data-pid="${idx}"]`);
        targetSlots.forEach(slot => {
            let idSpan = slot.id.replace('_s', '_p');
            document.getElementById(idSpan).innerText = n;
        });
    }

    function kira(idMatch) {
        let s1 = document.getElementById(idMatch + '_sc1');
        let s2 = document.getElementById(idMatch + '_sc2');
        
        if(s1.value === "" || s2.value === "") return;
        
        let v1 = parseInt(s1.value);
        let v2 = parseInt(s2.value);
        if(v1 === v2) return;

        // Visual Colors
        s1.className = (v1 > v2) ? 'skor skor-menang' : 'skor skor-kalah';
        s2.className = (v2 > v1) ? 'skor skor-menang' : 'skor skor-kalah';
        
        document.getElementById(idMatch + '_s1').classList.toggle('slot-menang', v1 > v2);
        document.getElementById(idMatch + '_s2').classList.toggle('slot-menang', v2 > v1);

        let p_menang = (v1 > v2) ? document.getElementById(idMatch + '_p1').innerText : document.getElementById(idMatch + '_p2').innerText;
        let id_menang = (v1 > v2) ? document.getElementById(idMatch + '_s1').getAttribute('data-pid') : document.getElementById(idMatch + '_s2').getAttribute('data-pid');
        
        let p_kalah = (v1 > v2) ? document.getElementById(idMatch + '_p2').innerText : document.getElementById(idMatch + '_p1').innerText;
        let id_kalah = (v1 > v2) ? document.getElementById(idMatch + '_s2').getAttribute('data-pid') : document.getElementById(idMatch + '_s1').getAttribute('data-pid');

        let parts = idMatch.split('_');
        let j = parts[0], p = parseInt(parts[1]), m = parseInt(parts[2]);

        // Logic Winners
        if(j === 'W') {
            hantarPemenang('W', p + 1, Math.floor(m / 2), (m % 2) + 1, p_menang, id_menang);
            // Logic Losers Drop
            let nextLP = (p === 0) ? 0 : (p * 2) - 1;
            let totalMatchRound = Math.pow(2, Math.log2(p2) - p - 1);
            let flipM = (m < totalMatchRound/2) ? (m + totalMatchRound/2) : (m - totalMatchRound/2);
            let nextLM = (p === 0) ? Math.floor(flipM / 2) : m;
            let nextLS = (p === 0) ? (flipM % 2) + 1 : 2;
            hantarPemenang('L', nextLP, nextLM, nextLS, p_kalah, id_kalah);
        } else if(j === 'L') {
            let nextLP = p + 1;
            let nextLM = (p % 2 === 0) ? m : Math.floor(m / 2);
            let nextLS = (p % 2 === 0) ? 1 : (m % 2) + 1;
            hantarPemenang('L', nextLP, nextLM, nextLS, p_menang, id_menang);
        } else if(j === 'GF') {
            alert("JUARA: " + p_menang);
        }
    }

    function hantarPemenang(jenis, pusingan, match, slot, nama, pid) {
        let targetID = `${jenis}_${pusingan}_${match}_p${slot}`;
        let targetSlot = `${jenis}_${pusingan}_${match}_s${slot}`;
        let el = document.getElementById(targetID);
        if(el) {
            el.innerText = nama;
            document.getElementById(targetSlot).setAttribute('data-pid', pid);
        } else {
            // Must be Grand Final
            let gf_slot = (jenis === 'W') ? 1 : 2;
            document.getElementById(`GF_0_0_p${gf_slot}`).innerText = nama;
            document.getElementById(`GF_0_0_s${gf_slot}`).setAttribute('data-pid', pid);
        }
    }

    function jana() {
        p2 = Math.pow(2, Math.ceil(Math.log2(nPasukan)));
        seeds = getSeeds(p2);
        matchCounter = 1;
        
        document.getElementById('gridPesertaAwam').innerHTML = "";
        document.getElementById('adminTeamInputs').innerHTML = "";
        
        for(let i=0; i<nPasukan; i++) {
            document.getElementById('gridPesertaAwam').innerHTML += `<div class="kad-peserta-ringkas">${i+1}. <span id="awam_nama_${i}">Pasukan ${i+1}</span></div>`;
            document.getElementById('adminTeamInputs').innerHTML += `<input type="text" placeholder="Nama T${i+1}" oninput="updateNama(${i}, this.value)" style="width:90%; margin-bottom:5px; background:#222; color:#fff; border:1px solid #444; padding:5px;">`;
        }
        
        renderBracket();
    }

    function renderBracket() {
        document.getElementById('barisW').innerHTML = "";
        document.getElementById('barisL').innerHTML = "";
        let rounds = Math.log2(p2);

        // Winner Bracket
        for(let r=0; r<rounds; r++) {
            let divR = document.createElement('div');
            divR.className = 'pusingan';
            divR.innerHTML = `<div class="tajuk-pusingan">Winner P${r+1}</div>`;
            let nMatch = Math.pow(2, rounds - r - 1);
            for(let m=0; m<nMatch; m++) divR.appendChild(createMatch('W', r, m));
            document.getElementById('barisW').appendChild(divR);
        }

        // Grand Final
        let gfC = document.createElement('div');
        gfC.className = 'gf-container';
        gfC.innerHTML = `<div class="pusingan"><div class="tajuk-pusingan" style="background:var(--emas); color:#000;">üèÜ GRAND FINAL</div><div id="gf_box"></div></div>`;
        document.getElementById('barisW').appendChild(gfC);
        document.getElementById('gf_box').appendChild(createMatch('GF', 0, 0, true));

        // Loser Bracket
        let lRounds = (rounds - 1) * 2;
        for(let r=0; r<lRounds; r++) {
            let divR = document.createElement('div');
            divR.className = 'pusingan';
            divR.innerHTML = `<div class="tajuk-pusingan">Loser P${r+1}</div>`;
            let nMatch = Math.pow(2, Math.floor((lRounds - r - 1) / 2));
            for(let m=0; m<nMatch; m++) divR.appendChild(createMatch('L', r, m));
            document.getElementById('barisL').appendChild(divR);
        }
        
        autoBye();
    }

    function createMatch(j, r, m, isGF=false) {
        let mId = `${j}_${r}_${m}`;
        let div = document.createElement('div');
        div.className = "kotak-perlawanan" + (isGF ? " grand-final" : "");
        div.id = mId;

        let p1 = "Menunggu...", p2 = "Menunggu...", id1="none", id2="none";

        if(j === 'W' && r === 0) {
            let s1 = seeds[m*2], s2 = seeds[m*2+1];
            p1 = (s1 < nPasukan) ? `Pasukan ${s1+1}` : "BYE";
            id1 = (s1 < nPasukan) ? s1 : "none";
            p2 = (s2 < nPasukan) ? `Pasukan ${s2+1}` : "BYE";
            id2 = (s2 < nPasukan) ? s2 : "none";
        }

        div.innerHTML = `
            <div class="match-no">MATCH ${matchCounter++}</div>
            <div class="slot-pasukan" id="${mId}_s1" data-pid="${id1}">
                <span class="nama-display" id="${mId}_p1">${p1}</span>
                <input type="number" class="skor" id="${mId}_sc1" oninput="kira('${mId}')">
            </div>
            <div class="slot-pasukan" id="${mId}_s2" data-pid="${id2}">
                <span class="nama-display" id="${mId}_p2">${p2}</span>
                <input type="number" class="skor" id="${mId}_sc2" oninput="kira('${mId}')">
            </div>
        `;
        return div;
    }

    function autoBye() {
        let inputs = document.querySelectorAll('.skor');
        inputs.forEach(inp => {
            let mid = inp.id.split('_sc')[0];
            let p1 = document.getElementById(mid + '_p1').innerText;
            let p2 = document.getElementById(mid + '_p2').innerText;
            if(p1 === "BYE") { document.getElementById(mid + '_sc1').value = 0; document.getElementById(mid + '_sc2').value = 1; kira(mid); }
            if(p2 === "BYE") { document.getElementById(mid + '_sc1').value = 1; document.getElementById(mid + '_sc2').value = 0; kira(mid); }
        });
    }

    function getSeeds(n) {
        let s = [0, 1];
        while(s.length < n) {
            let nextS = [];
            for(let i=0; i<s.length; i++) {
                nextS.push(s[i]);
                nextS.push(2 * s.length - 1 - s[i]);
            }
            s = nextS;
        }
        return s;
    }

    window.onload = jana;
</script>

</body>
</html>
