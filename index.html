<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Double Elimination - Bye System Pro</title>
<style>
    :root{ --menang:#2ecc71;--kalah:#e74c3c;--utama:#00d2ff;--emas:#ffd700;--bg:#0b0b0d;--kad:#1a1a1f; }
    body{ font-family:'Segoe UI', sans-serif; background:var(--bg); color:#fff; padding:20px; }
    .kawalan{ background:var(--kad); padding:15px; border-radius:12px; display:flex; gap:10px; align-items:center; justify-content:center; position:sticky; top:10px; z-index:99; border:1px solid #333; margin-bottom:30px; }
    button{ background:var(--utama); color:#000; font-weight:bold; cursor:pointer; border-radius:6px; padding:8px 15px; border:none; }
    .tournament-layout { display: grid; grid-template-columns: 1fr 300px; gap:30px; max-width:1500px; margin:0 auto; }
    .brackets-side { display:flex; flex-direction:column; gap:80px; }
    .laluan-row { display:flex; gap:40px; padding-bottom:20px; overflow-x:auto; }
    .pusingan { display:flex; flex-direction:column; gap:20px; min-width:220px; justify-content:space-around; }
    .tajuk-pusingan { font-size:.7rem; color:var(--utama); border-bottom:2px solid #333; text-align:center; padding-bottom:5px; margin-bottom:15px; }
    .kotak-perlawanan { background:var(--kad); border:1px solid #333; border-radius:8px; overflow:hidden; }
    .id-perlawanan { font-size:.6rem; padding:4px 10px; background:#25252b; color:#888; border-bottom:1px solid #333; }
    .slot-pasukan { display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #222; }
    .slot-bye { background: #333; opacity: 0.6; font-style: italic; color: #aaa; }
    input[type=text], .nama-display { flex:1; border:none; background:transparent; color:#fff; font-size:0.85rem; outline:none; }
    .skor { width:35px; text-align:center; background:#000; border:1px solid #444; color:#fff; border-radius:4px; }
    .grand-final-area { display:flex; align-items:center; justify-content:center; }
    .grand-final { border:2px solid var(--emas); box-shadow:0 0 30px rgba(255,215,0,0.2); width:280px; }
    .teks-menang { color:var(--menang); font-weight:bold; }
    .teks-kalah { color:var(--kalah); opacity:0.5; text-decoration:line-through; }
    .skor-menang { background:var(--menang) !important; }
</style>
</head>
<body>

<div class="kawalan">
    <label>Jumlah Pasukan:</label>
    <input type="number" id="bilPasukan" value="6" min="4" style="width:60px; background:#000; color:#fff; border:1px solid #444; padding:5px;">
    <button onclick="jana()">Reset & Jana Bracket</button>
</div>

<div class="tournament-layout">
    <div class="brackets-side">
        <div id="barisW" class="laluan-row"></div>
        <div id="barisL" class="laluan-row"></div>
    </div>
    <div class="grand-final-area">
        <div id="grandFinal"></div>
    </div>
</div>

<script>
let totalTeams = 8;
let powerOfTwo = 8;

function jana() {
    totalTeams = parseInt(document.getElementById('bilPasukan').value);
    powerOfTwo = Math.pow(2, Math.ceil(Math.log2(totalTeams)));
    
    const barisW = document.getElementById('barisW');
    const barisL = document.getElementById('barisL');
    const gfArea = document.getElementById('grandFinal');
    barisW.innerHTML = ''; barisL.innerHTML = ''; gfArea.innerHTML = '';

    const pLen = Math.log2(powerOfTwo);

    // Winners
    for(let p=0; p<pLen; p++) {
        let col = document.createElement('div');
        col.className = 'pusingan';
        col.innerHTML = `<div class="tajuk-pusingan">WINNERS R${p+1}</div>`;
        let matches = Math.pow(2, pLen - p - 1);
        for(let m=0; m<matches; m++) col.appendChild(kotak('W', p, m));
        barisW.appendChild(col);
    }

    // Losers
    let lTotal = (pLen - 1) * 2;
    for(let p=0; p<lTotal; p++) {
        let col = document.createElement('div');
        col.className = 'pusingan';
        col.innerHTML = `<div class="tajuk-pusingan">LOSERS R${p+1}</div>`;
        let matches = Math.pow(2, Math.floor((lTotal - p - 1) / 2));
        for(let m=0; m<matches; m++) col.appendChild(kotak('L', p, m));
        barisL.appendChild(col);
    }
    gfArea.appendChild(kotak('GF', 0, 0, true));

    // Handle initial Byes
    checkByes();
}

function kotak(j, p, m, gf=false) {
    const id = `${j}_${p}_${m}`;
    const isW1 = (j === 'W' && p === 0);
    
    // Check if slot p2 should be a BYE in Round 1
    let p1Bye = false;
    let p2Bye = false;
    if(isW1) {
        if ((m * 2) >= totalTeams) p1Bye = true;
        if ((m * 2 + 1) >= totalTeams) p2Bye = true;
    }

    let div = document.createElement('div');
    div.className = 'kotak-perlawanan' + (gf ? ' grand-final' : '');
    div.id = id;

    div.innerHTML = `
        <div class="id-perlawanan">${gf ? 'ðŸ‘‘ GRAND FINAL' : id.replace('_',' ')}</div>
        <div class="slot-pasukan ${p1Bye?'slot-bye':''}">
            ${isW1 ? `<input type="text" id="${id}_p1" value="${p1Bye?'BYE':'Pasukan '+(m*2+1)}" ${p1Bye?'disabled':''}>` : `<span id="${id}_p1" class="nama-display">Menunggu...</span>`}
            <input type="number" class="skor" oninput="kemaskini('${id}')" ${p1Bye?'disabled':''}>
        </div>
        <div class="slot-pasukan ${p2Bye?'slot-bye':''}">
            ${isW1 ? `<input type="text" id="${id}_p2" value="${p2Bye?'BYE':'Pasukan '+(m*2+2)}" ${p2Bye?'disabled':''}>` : `<span id="${id}_p2" class="nama-display">Menunggu...</span>`}
            <input type="number" class="skor" oninput="kemaskini('${id}')" ${p2Bye?'disabled':''}>
        </div>
    `;
    return div;
}

function checkByes() {
    // Cari mana-mana match di W R1 yang ada "BYE"
    const matches = document.querySelectorAll('[id^="W_0_"]');
    matches.forEach(match => {
        const p1 = document.getElementById(match.id + '_p1');
        const p2 = document.getElementById(match.id + '_p2');
        const skors = match.querySelectorAll('.skor');

        if (p2.value === "BYE") {
            skors[0].value = 1; skors[1].value = 0;
            kemaskini(match.id);
        } else if (p1.value === "BYE") {
            skors[0].value = 0; skors[1].value = 1;
            kemaskini(match.id);
        }
    });
}

function kemaskini(id) {
    let box = document.getElementById(id);
    let s = box.querySelectorAll('.skor');
    if (s[0].value === '' || s[1].value === '') return;

    let v1 = parseInt(s[0].value), v2 = parseInt(s[1].value);
    let n1 = document.getElementById(id + '_p1'), n2 = document.getElementById(id + '_p2');
    let nama1 = n1.value || n1.innerText, nama2 = n2.value || n2.innerText;

    let menang = v1 > v2 ? nama1 : nama2;
    let kalah = v1 > v2 ? nama2 : nama1;

    n1.className = v1 > v2 ? 'teks-menang' : (v1 < v2 ? 'teks-kalah' : '');
    n2.className = v2 > v1 ? 'teks-menang' : (v2 < v1 ? 'teks-kalah' : '');
    s[0].className = v1 > v2 ? 'skor skor-menang' : 'skor';
    s[1].className = v2 > v1 ? 'skor skor-menang' : 'skor';

    let parts = id.split('_');
    let j = parts[0], p = parseInt(parts[1]), m = parseInt(parts[2]);

    if (j === 'W') {
        let nextW = document.getElementById(`W_${p+1}_${Math.floor(m/2)}_p${(m%2)+1}`);
        if (nextW) nextW.innerText = menang; else document.getElementById('GF_0_0_p1').innerText = menang;

        if (kalah !== "BYE") {
            let targetLRound = p === 0 ? 0 : p * 1; 
            let targetM = m, targetSlot = 'p2';
            if (p === 0) {
                let totalM = powerOfTwo / 2;
                let flippedM = (m < totalM / 2) ? (m + totalM / 2) : (m - totalM / 2);
                targetM = Math.floor(flippedM / 2);
                targetSlot = `p${(flippedM % 2) + 1}`;
            }
            let targetLElem = document.getElementById(`L_${targetLRound}_${targetM}_${targetSlot}`);
            if (targetLElem) targetLElem.innerText = kalah;
        }
    } 
    else if (j === 'L') {
        let np = p + 1;
        let nm = (p % 2 === 0) ? m : Math.floor(m/2);
        let ns = (p % 2 === 0) ? 'p1' : `p${(m%2)+1}`;
        let nextL = document.getElementById(`L_${np}_${nm}_${ns}`);
        if (nextL) nextL.innerText = menang; else document.getElementById('GF_0_0_p2').innerText = menang;
    }
}
jana();
</script>
</body>
</html>
