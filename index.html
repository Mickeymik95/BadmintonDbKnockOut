<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>BWF BADMINTON SUPER SERIES FAMILY TOUR</title>
    <style>
        :root { 
            --menang: #2ecc71; --kalah: #e74c3c; --utama: #00d2ff; 
            --emas: #ffd700; --bg: #0b0b0d; --kad: #1a1a1f; 
            --ws-hijau: #25D366; --garis: #333; 
            --biru-nombor: rgba(0, 229, 255, 0.5); 
            --bg-menang: rgba(0, 210, 255, 0.04);
            --bg-kalah: rgba(231, 76, 60, 0.04);
            --max-width: 1300px; 
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; padding: 20px; margin: 0; }
        
        .container-pusat { display: flex; flex-direction: column; align-items: center; width: 100%; }

        /* HEADER SECTION */
        .section-box { width: 100%; max-width: var(--max-width); margin-bottom: 60px; position: relative; }
        .header-container { background: rgba(255, 255, 255, 0.03); padding: 30px; border-radius: 40px; border: 1px solid var(--garis); }
        .header-top { display: flex; align-items: center; justify-content: space-between; gap: 20px; }
        .logo-box img { height: 120px; width: 120px; border-radius: 20px; filter: drop-shadow(0 0 10px var(--utama)); object-fit: cover; }
        
        .tajuk-box h1 { font-size: 2.2rem; margin: 0; background: linear-gradient(130deg, #00d2ff, #2ecc71, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; text-align: center; }
        .siri-tag { font-size: 1.2rem; color: var(--emas); letter-spacing: 8px; font-weight: 900; display: block; text-align: center; }

        .btn-admin-besar { height: 100px; width: 100px; border-radius: 20px; border: 3px solid var(--utama); background: rgba(0, 210, 255, 0.1); color: var(--utama); cursor: pointer; font-weight: 900; font-size: 0.8rem; transition: 0.3s; }
        .btn-admin-besar:hover { background: var(--utama); color: #000; box-shadow: 0 0 20px var(--utama); }

        /* WHATSAPP */
        .admin-header-grid { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .admin-ws-card { width: 150px; height: 70px; background: rgba(37, 211, 102, 0.05); border: 1px solid var(--ws-hijau); border-radius: 12px; text-decoration: none; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .ws-name { color: #fff; font-weight: bold; font-size: 0.8rem; margin: 0; }
        .ws-role { color: var(--emas); font-size: 0.6rem; text-transform: uppercase; margin: 0; }

        /* LABEL TAJUK - FIX TERTUTUP */
        .label-bracket { 
            position: absolute; top: -20px; left: 30px; 
            background: var(--bg); padding: 8px 30px; 
            font-weight: 900; font-size: 1.1rem; border-radius: 50px; 
            border: 3px solid; z-index: 100;
        }
        .label-penyertaan { color: var(--emas); border-color: var(--emas); }
        .label-menang { color: var(--utama); border-color: var(--utama); }
        .label-kalah { color: var(--kalah); border-color: var(--kalah); }

        /* SENARAI PENYERTAAN */
        .senarai-container { background: rgba(255,255,255,0.02); border-radius: 30px; padding: 40px 25px 25px; border: 1px solid var(--garis); }
        .grid-penyertaan { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .kad-pasukan { background: #111; border: 1px solid #333; border-radius: 10px; padding: 8px; display: flex; align-items: center; gap: 10px; }
        .no-p { background: var(--biru-nombor); color: #000; font-weight: 900; width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; }

        /* BRACKET SYSTEM - REBUILT */
        .tournament-wrapper { width: 100%; max-width: var(--max-width); overflow-x: auto; padding: 20px 0; }
        .scroll-container { display: flex; flex-direction: column; gap: 80px; width: max-content; }

        .bracket-box { 
            display: table; /* Supaya border ikut lebar pusingan */
            border-radius: 40px; border: 3px solid; 
            position: relative; padding: 60px 40px 40px 40px; 
        }
        .box-menang { background: var(--bg-menang); border-color: var(--utama); }
        .box-kalah { background: var(--bg-kalah); border-color: var(--kalah); }

        .flex-pusingan { display: flex; gap: 40px; }
        .pusingan-col { display: flex; flex-direction: column; gap: 30px; width: 240px; justify-content: center; }
        .round-title { font-size: 0.75rem; font-weight: 900; text-align: center; padding: 8px; background: #000; border: 1px solid #444; border-radius: 6px; margin-bottom: 10px; border-bottom: 3px solid var(--emas); }

        /* MATCH BOX */
        .match-card { background: var(--kad); border: 1px solid #333; border-radius: 14px; position: relative; padding-top: 22px; }
        .match-label { position: absolute; top: 0; left: 0; right: 0; background: #25252b; color: var(--utama); font-size: 8px; padding: 4px; text-align: center; font-weight: bold; border-radius: 13px 13px 0 0; }
        .team-row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; height: 45px; border-bottom: 1px solid #222; }
        .team-row:last-child { border-bottom: none; }
        .team-name { flex: 1; font-size: 0.85rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .team-logo { width: 24px; height: 24px; border-radius: 4px; background: #333; }
        .score-input { width: 35px; height: 28px; text-align: center; background: #000; border: 1px solid #444; color: #fff; border-radius: 4px; font-weight: 900; }
        .score-input[readonly] { opacity: 0.5; cursor: not-allowed; }
        .win { background: var(--menang) !important; color: #000 !important; border: none; }
        .lose { background: var(--kalah) !important; color: #fff !important; border: none; }
        .gf-style { border: 3px solid var(--emas) !important; box-shadow: 0 0 20px rgba(255, 215, 0, 0.2); }

        /* ADMIN PANEL */
        #adminPanel { display: none; position: fixed; top: 20px; right: 20px; width: 320px; max-height: 80vh; background: #1a1a1f; border: 2px solid var(--utama); border-radius: 20px; z-index: 1000; padding: 20px; overflow-y: auto; box-shadow: 0 10px 50px #000; }
        .admin-input { width: 100%; padding: 10px; margin-bottom: 10px; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="container-pusat">
    <div class="section-box">
        <div class="header-container">
            <div class="header-top">
                <div class="logo-box"><img src="logo.jpeg" onerror="this.src='https://via.placeholder.com/120'"></div>
                <div class="tajuk-box">
                    <h1>BWF BADMINTON FAMILY TOUR</h1>
                    <span class="siri-tag">SIRI II</span>
                </div>
                <button class="btn-admin-besar" onclick="toggleAdmin()">ADMIN<br>PANEL</button>
            </div>
            <div class="admin-header-grid">
                <a href="https://wa.me/60149236577" target="_blank" class="admin-ws-card"><p class="ws-name">Ammik</p><p class="ws-role">Teknikal</p></a>
                <a href="https://wa.me/601111639636" target="_blank" class="admin-ws-card"><p class="ws-name">Anggan</p><p class="ws-role">Penganjur</p></a>
                <a href="https://wa.me/601139058698" target="_blank" class="admin-ws-card"><p class="ws-name">Banding</p><p class="ws-role">Timbalan</p></a>
                <a href="https://wa.me/60128228860" target="_blank" class="admin-ws-card"><p class="ws-name">Azis</p><p class="ws-role">Pengerusi</p></a>
            </div>
        </div>
    </div>

    <div class="section-box">
        <div class="label-bracket label-penyertaan">SENARAI PENYERTAAN</div>
        <div class="senarai-container">
            <div id="listPenyertaan" class="grid-penyertaan"></div>
        </div>
    </div>

    <div class="tournament-wrapper">
        <div class="scroll-container">
            
            <div class="bracket-box box-menang">
                <div class="label-bracket label-menang">BRACKET MENANG</div>
                <div id="bracketW" class="flex-pusingan"></div>
            </div>

            <div class="bracket-box box-kalah">
                <div class="label-bracket label-kalah">BRACKET KALAH (NYAWA KEDUA)</div>
                <div id="bracketL" class="flex-pusingan"></div>
            </div>

        </div>
    </div>
</div>

<div id="adminPanel">
    <div onclick="toggleAdmin()" style="float:right; cursor:pointer; color:red; font-weight:bold;">[X]</div>
    <h3 style="color:var(--utama);">Control Panel</h3>
    <input type="password" id="pass" class="admin-input" placeholder="Password">
    <button onclick="login()" style="width:100%; padding:10px; background:var(--utama); border:none; border-radius:8px; font-weight:bold;">LOGIN</button>
    
    <div id="adminContent" style="display:none; margin-top:20px;">
        <label style="font-size:10px; color:var(--emas);">BILANGAN PASUKAN:</label>
        <input type="number" id="numTeams" class="admin-input" value="14">
        <div id="teamEditor"></div>
        <div style="display:flex; gap:10px;">
            <button onclick="jana()" style="flex:1; padding:10px; background:var(--menang); border:none; border-radius:8px;">REFRESH</button>
            <button onclick="save()" style="flex:1; padding:10px; background:var(--utama); border:none; border-radius:8px;">SAVE</button>
        </div>
    </div>
</div>

<script>
    let nPasukan = 14, p2 = 16, teamData = {}, isAdmin = false, matchCount = 1;

    function toggleAdmin() { let p = document.getElementById('adminPanel'); p.style.display = p.style.display==='block'?'none':'block'; }
    
    function login() { 
        if(document.getElementById('pass').value==="admin123") {
            document.getElementById('adminContent').style.display='block';
            isAdmin = true; updateInputs();
        } else alert("Salah!");
    }

    function updateInputs() { document.querySelectorAll('.score-input').forEach(i => i.readOnly = !isAdmin); }

    function updateTeam(i, field, val) {
        if(!teamData[i]) teamData[i] = { nama: `Pasukan ${i+1}`, logo: '' };
        teamData[i][field] = val;
        jana();
    }

    function jana() {
        matchCount = 1;
        nPasukan = parseInt(document.getElementById('numTeams').value) || 14;
        p2 = Math.pow(2, Math.ceil(Math.log2(nPasukan)));
        let seeds = getSeeds(p2);

        document.getElementById('teamEditor').innerHTML = "";
        document.getElementById('listPenyertaan').innerHTML = "";
        
        for(let i=0; i<nPasukan; i++) {
            if(!teamData[i]) teamData[i] = { nama: `Pasukan ${i+1}`, logo: '' };
            document.getElementById('teamEditor').innerHTML += `<div style="display:flex; gap:5px; margin-bottom:5px;"><input class="admin-input" style="margin:0;" value="${teamData[i].nama}" oninput="updateTeam(${i},'nama',this.value)"><input class="admin-input" style="margin:0;" value="${teamData[i].logo}" oninput="updateTeam(${i},'logo',this.value)"></div>`;
            document.getElementById('listPenyertaan').innerHTML += `<div class="kad-pasukan"><div class="no-p">${i+1}</div><img src="${teamData[i].logo||'https://via.placeholder.com/24'}" class="team-logo"><div class="team-name">${teamData[i].nama}</div></div>`;
        }
        renderBracket(seeds);
        updateInputs();
    }

    function renderBracket(seeds) {
        const bw = document.getElementById('bracketW'), bl = document.getElementById('bracketL');
        bw.innerHTML = ""; bl.innerHTML = "";
        let rounds = Math.log2(p2);

        // Winner Bracket
        for(let r=0; r<rounds; r++) {
            let col = document.createElement('div'); col.className = "pusingan-col";
            col.innerHTML = `<div class="round-title">PUSINGAN ${r+1}</div>`;
            for(let m=0; m<Math.pow(2, rounds-r-1); m++) col.appendChild(createMatch('W', r, m, seeds));
            bw.appendChild(col);
        }
        // Grand Final
        let gfCol = document.createElement('div'); gfCol.className = "pusingan-col";
        gfCol.innerHTML = `<div class="round-title" style="background:var(--emas); color:#000;">GRAND FINAL</div>`;
        gfCol.appendChild(createMatch('GF', 0, 0, null, true));
        bw.appendChild(gfCol);

        // Loser Bracket
        for(let r=0; r<(rounds-1)*2; r++) {
            let col = document.createElement('div'); col.className = "pusingan-col";
            col.innerHTML = `<div class="round-title">KALAH P${r+1}</div>`;
            for(let m=0; m<Math.pow(2, Math.floor(((rounds-1)*2-r-1)/2)); m++) col.appendChild(createMatch('L', r, m));
            bl.appendChild(col);
        }
        checkBye();
    }

    function createMatch(j, r, m, seeds, isGF=false) {
        let mid = `${j}_${r}_${m}`;
        let div = document.createElement('div'); div.className = "match-card" + (isGF?" gf-style":"");
        div.id = mid;
        let t1 = "Menunggu...", t2 = "Menunggu...", id1="none", id2="none";

        if(j==='W' && r===0) {
            let s1 = seeds[m*2], s2 = seeds[m*2+1];
            t1 = s1<nPasukan?teamData[s1].nama : "BYE"; id1 = s1<nPasukan?s1:"none";
            t2 = s2<nPasukan?teamData[s2].nama : "BYE"; id2 = s2<nPasukan?s2:"none";
        }

        div.innerHTML = `<div class="match-label">MATCH ${matchCount++}</div>
            <div class="team-row" id="${mid}_s1" data-pid="${id1}"><img src="${id1!=='none'?(teamData[id1].logo||'https://via.placeholder.com/24'):'https://via.placeholder.com/24'}" class="team-logo" id="${mid}_img1"><span class="team-name" id="${mid}_p1">${t1}</span><input type="number" class="score-input" id="${mid}_sc1" oninput="kira('${mid}')" readonly></div>
            <div class="team-row" id="${mid}_s2" data-pid="${id2}"><img src="${id2!=='none'?(teamData[id2].logo||'https://via.placeholder.com/24'):'https://via.placeholder.com/24'}" class="team-logo" id="${mid}_img2"><span class="team-name" id="${mid}_p2">${t2}</span><input type="number" class="score-input" id="${mid}_sc2" oninput="kira('${mid}')" readonly></div>`;
        return div;
    }

    function kira(mid) {
        let s1 = document.getElementById(mid+'_sc1'), s2 = document.getElementById(mid+'_sc2');
        if(!s1.value || !s2.value) return;
        let v1 = parseInt(s1.value), v2 = parseInt(s2.value);
        if(v1===v2) return;

        s1.className = v1>v2?'score-input win':'score-input lose';
        s2.className = v2>v1?'score-input win':'score-input lose';

        let win_n = v1>v2?document.getElementById(mid+'_p1').innerText:document.getElementById(mid+'_p2').innerText;
        let win_id = v1>v2?document.getElementById(mid+'_s1').dataset.pid:document.getElementById(mid+'_s2').dataset.pid;
        let los_n = v1>v2?document.getElementById(mid+'_p2').innerText:document.getElementById(mid+'_p1').innerText;
        let los_id = v1>v2?document.getElementById(mid+'_s2').dataset.pid:document.getElementById(mid+'_s1').dataset.pid;

        let [j, r, m] = mid.split('_'); r = parseInt(r); m = parseInt(m);
        if(j==='W') {
            hantar('W', r+1, Math.floor(m/2), (m%2)+1, win_n, win_id);
            let nextLP = (r===0)?0:(r*2)-1;
            let totalM = Math.pow(2, Math.log2(p2)-r-1);
            let flipM = (m < totalM/2)?(m+totalM/2):(m-totalM/2);
            hantar('L', nextLP, (r===0)?Math.floor(flipM/2):m, (r===0)?(flipM%2)+1:2, los_n, los_id);
        } else if(j==='L') {
            hantar('L', r+1, (r%2===0)?m:Math.floor(m/2), (r%2===0)?1:(m%2)+1, win_n, win_id);
        }
    }

    function hantar(j, r, m, s, nama, pid) {
        let tid = `${j}_${r}_${m}_s${s}`;
        let slot = document.getElementById(tid);
        if(slot) {
            document.getElementById(`${j}_${r}_${m}_p${s}`).innerText = nama;
            slot.dataset.pid = pid;
            document.getElementById(`${j}_${r}_${m}_img${s}`).src = teamData[pid]?.logo || 'https://via.placeholder.com/24';
            checkBye();
        } else if(j==='W' || (j==='L' && r===(Math.log2(p2)-1)*2)) {
            let side = (j==='W')?1:2;
            document.getElementById(`GF_0_0_p${side}`).innerText = nama;
            document.getElementById(`GF_0_0_s${side}`).dataset.pid = pid;
            document.getElementById(`GF_0_0_img${side}`).src = teamData[pid]?.logo || 'https://via.placeholder.com/24';
        }
    }

    function checkBye() {
        document.querySelectorAll('.score-input').forEach(inp => {
            let mid = inp.id.split('_sc')[0];
            let t1 = document.getElementById(mid+'_p1').innerText, t2 = document.getElementById(mid+'_p2').innerText;
            if((t1==="BYE" || t2==="BYE") && inp.value==="") {
                document.getElementById(mid+'_sc1').value = (t1==="BYE"?0:21);
                document.getElementById(mid+'_sc2').value = (t2==="BYE"?0:21);
                let old = isAdmin; isAdmin = true; kira(mid); isAdmin = old;
            }
        });
    }

    function save() {
        let sc = {}; document.querySelectorAll('.score-input').forEach(i => sc[i.id]=i.value);
        localStorage.setItem('bwf_final', JSON.stringify({n:nPasukan, td:teamData, sc:sc}));
        alert("Data Berjaya Disimpan!");
    }

    function muat() {
        let d = JSON.parse(localStorage.getItem('bwf_final'));
        if(d) {
            nPasukan=d.n; teamData=d.td; document.getElementById('numTeams').value=nPasukan; jana();
            setTimeout(() => { for(let id in d.sc) { if(d.sc[id]!=="") { let i=document.getElementById(id); if(i){ i.value=d.sc[id]; let old=isAdmin; isAdmin=true; kira(id.split('_sc')[0]); isAdmin=old; } } } }, 100);
        }
    }

    function getSeeds(n) { let s=[0,1]; while(s.length<n) { let ns=[]; for(let i=0; i<s.length; i++) { ns.push(s[i]); ns.push(2*s.length-1-s[i]); } s=ns; } return s; }
    window.onload = () => { muat(); if(!Object.keys(teamData).length) jana(); };
</script>
</body>
</html>
