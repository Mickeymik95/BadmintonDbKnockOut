<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Double Elimination - Susunan Kemas</title>
<style>
    :root{ --menang:#2ecc71;--kalah:#e74c3c;--utama:#00d2ff;--emas:#ffd700;--bg:#0b0b0d;--kad:#1a1a1f; }
    body{ font-family:'Segoe UI', sans-serif; background:var(--bg); color:#fff; padding:20px; margin:0; }
    
    .kawalan{ 
        background:var(--kad); padding:15px; border-radius:12px; 
        display:flex; gap:10px; align-items:center; justify-content:center; 
        position:sticky; top:10px; z-index:99; border:1px solid #333; margin-bottom:30px; 
    }

    /* Layout utama menggunakan Flexbox untuk susunan yang lebih fleksibel */
    .tournament-container {
        display: flex;
        gap: 40px;
        justify-content: center;
        align-items: flex-start;
        max-width: 100%;
        margin: 0 auto;
    }

    .bracket-columns { display: flex; gap: 40px; }
    
    .pusingan { display: flex; flex-direction: column; gap: 40px; min-width: 220px; }
    
    /* Bahagian Winners dan Losers diasingkan secara menegak dalam lajur */
    .laluan-menang, .laluan-kalah { display: flex; flex-direction: column; gap: 60px; }

    .tajuk-pusingan { 
        font-size:.7rem; color:var(--utama); font-weight:bold; 
        border-bottom:2px solid #333; text-align:center; padding-bottom:8px; 
        margin-bottom:15px; text-transform:uppercase; 
    }

    .kotak-perlawanan { background:var(--kad); border:1px solid #333; border-radius:8px; overflow:hidden; position: relative; }
    .slot-pasukan { display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #222; }
    .slot-bye { background: #25252b; color: #555; font-style: italic; }
    
    .nama-display { flex:1; border:none; background:transparent; color:#fff; font-size:0.85rem; }
    .skor { width:30px; text-align:center; background:#000; border:1px solid #444; color:#fff; border-radius:4px; font-weight:bold; }
    .skor.sembunyi { display: none; }

    /* Grand Final diletakkan secara spesifik */
    .grand-final-wrap {
        display: flex;
        flex-direction: column;
        justify-content: center; /* Ini yang buat dia duduk di tengah */
        min-height: 100%;
    }
    .grand-final { 
        border: 2px solid var(--emas) !important; 
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.15); 
        width: 250px;
        margin-top: auto;
        margin-bottom: auto;
    }

    .teks-menang { color:var(--menang); font-weight:bold; }
    .teks-kalah { color:var(--kalah); opacity:0.6; text-decoration:line-through; }
    .skor-menang { background:var(--menang) !important; color:#000 !important; }
    
    button{ background:var(--utama); color:#000; font-weight:bold; cursor:pointer; border-radius:6px; padding:8px 15px; border:none; }
</style>
</head>
<body>

<div class="kawalan">
    <label>Bilangan Pasukan:</label>
    <input type="number" id="bilPasukan" value="6" min="2" style="width:60px; background:#000; color:#fff; border:1px solid #444; padding:5px;">
    <button onclick="jana()">Jana Jadual</button>
</div>

<div class="tournament-container">
    <div id="bracketZone" class="bracket-columns">
        </div>
</div>

<script>
let config = { n: 0, p2: 0 };

function jana() {
    config.n = parseInt(document.getElementById('bilPasukan').value);
    config.p2 = Math.pow(2, Math.ceil(Math.log2(config.n)));
    
    const zone = document.getElementById('bracketZone');
    zone.innerHTML = '';

    const pLen = Math.log2(config.p2);
    const totalCols = pLen + 1; // Pusingan + Grand Final

    // Jana Lajur
    for(let c = 0; c < totalCols; c++) {
        let colDiv = document.createElement('div');
        colDiv.className = 'pusingan';
        
        // Pusingan Biasa (Winners & Losers)
        if (c < pLen) {
            // Laluan Menang (UB)
            let ubMatchCount = Math.pow(2, pLen - c - 1);
            if (ubMatchCount >= 1) {
                let ubTitle = `<div class="tajuk-pusingan">P. Menang ${c+1}</div>`;
                colDiv.innerHTML += ubTitle;
                for(let m=0; m < ubMatchCount; m++) colDiv.appendChild(buatKotak('W', c, m));
            }

            // Laluan Kalah (LB)
            // LB pusingan 1 & 2 dalam lajur 1, pusingan 3 & 4 dalam lajur 2, dsb.
            let lbRoundA = c * 2;
            let lbRoundB = c * 2 + 1;

            [lbRoundA, lbRoundB].forEach(lbP => {
                let lTotalRounds = (pLen - 1) * 2;
                if (lbP < lTotalRounds) {
                    let mCount = Math.pow(2, Math.floor((lTotalRounds - lbP - 1) / 2));
                    if (mCount >= 1) {
                        colDiv.innerHTML += `<div class="tajuk-pusingan">P. Kalah ${lbP+1}</div>`;
                        for(let m=0; m < mCount; m++) colDiv.appendChild(buatKotak('L', lbP, m));
                    }
                }
            });
        } 
        // Lajur Terakhir untuk Grand Final
        else {
            colDiv.className = 'pusingan grand-final-wrap';
            colDiv.innerHTML = `<div class="tajuk-pusingan">Grand Final</div>`;
            colDiv.appendChild(buatKotak('GF', 0, 0, true));
        }
        
        zone.appendChild(colDiv);
    }
    prosesByeAwal();
}

function buatKotak(j, p, m, gf=false) {
    const id = `${j}_${p}_${m}`;
    let div = document.createElement('div');
    div.className = 'kotak-perlawanan' + (gf ? ' grand-final' : '');
    div.id = id;

    let n1 = "Menunggu...", n2 = "Menunggu...";
    let b1 = false, b2 = false;

    if (j === 'W' && p === 0) {
        let slot1 = m * 2; let slot2 = m * 2 + 1;
        // Taburan Bye: Pasukan 1 (atas), Pasukan terakhir (bawah)
        n1 = (slot1 < config.n) ? `Pasukan ${slot1 + 1}` : "BYE";
        n2 = (slot2 < config.n) ? `Pasukan ${slot2 + 1}` : "BYE";
        
        // Custom 6 teams: Bye di perlawanan 1 (slot 2) dan perlawanan 4 (slot 2)
        if(config.n == 6) {
            if(m == 0) { n1 = "Pasukan 1"; n2 = "BYE"; }
            if(m == 3) { n1 = "Pasukan 6"; n2 = "BYE"; }
        }

        b1 = (n1 === "BYE"); b2 = (n2 === "BYE");
    }

    div.innerHTML = `
        <div style="font-size:8px; padding:2px 8px; color:#444; background:#141418;">${id}</div>
        <div class="slot-pasukan ${b1?'slot-bye':''}">
            <span id="${id}_p1" class="nama-display">${n1}</span>
            <input type="number" class="skor ${b1?'sembunyi':''}" oninput="kemaskini('${id}')" ${b1?'disabled':''}>
        </div>
        <div class="slot-pasukan ${b2?'slot-bye':''}">
            <span id="${id}_p2" class="nama-display">${n2}</span>
            <input type="number" class="skor ${b2?'sembunyi':''}" oninput="kemaskini('${id}')" ${b2?'disabled':''}>
        </div>
    `;
    return div;
}

function prosesByeAwal() {
    for(let m=0; m < config.p2/2; m++) {
        let id = `W_0_${m}`;
        let n1 = document.getElementById(id+'_p1').innerText;
        let n2 = document.getElementById(id+'_p2').innerText;
        let s = document.getElementById(id).querySelectorAll('.skor');
        if (n2 === "BYE" || n2 === "BYE (Auto)") { s[0].value = 1; s[1].value = 0; kemaskini(id); }
        else if (n1 === "BYE" || n1 === "BYE (Auto)") { s[0].value = 0; s[1].value = 1; kemaskini(id); }
    }
}

function kemaskini(id) {
    let box = document.getElementById(id);
    let s = box.querySelectorAll('.skor');
    if (s[0].value === '' || s[1].value === '') return;
    let v1 = parseInt(s[0].value), v2 = parseInt(s[1].value);
    if (v1 === v2) return;

    let n1 = document.getElementById(id + '_p1'), n2 = document.getElementById(id + '_p2');
    let menang = v1 > v2 ? n1.innerText : n2.innerText;
    let kalah = v1 > v2 ? n2.innerText : n1.innerText;

    n1.className = v1 > v2 ? 'nama-display teks-menang' : 'nama-display teks-kalah';
    n2.className = v2 > v1 ? 'nama-display teks-menang' : 'nama-display teks-kalah';
    s[0].classList.toggle('skor-menang', v1 > v2);
    s[1].classList.toggle('skor-menang', v2 > v1);

    let [j, p, m] = id.split('_').map(x => isNaN(x) ? x : parseInt(x));

    if (j === 'W') {
        let nextW = document.getElementById(`W_${p+1}_${Math.floor(m/2)}_p${(m%2)+1}`);
        if (nextW) nextW.innerText = menang; else document.getElementById('GF_0_0_p1').innerText = menang;
        
        let targetP = (p === 0) ? 0 : p * 2 - 1;
        let targetM = m, targetSlot = (p === 0) ? 0 : "p2";
        if (p === 0) {
            let totalM = (config.p2 / 2);
            let flipM = (m < totalM/2) ? (m + totalM/2) : (m - totalM/2);
            targetM = Math.floor(flipM / 2); targetSlot = `p${(flipM % 2) + 1}`;
        }
        let target = document.getElementById(`L_${targetP}_${targetM}_${targetSlot}`);
        if (target) {
            target.innerText = (kalah === "BYE") ? "BYE (Auto)" : kalah;
            if(kalah === "BYE") {
                target.parentElement.classList.add('slot-bye');
                target.nextElementSibling.classList.add('sembunyi');
                setTimeout(() => prosesByeAwal(), 50);
            }
        }
    } else if (j === 'L') {
        let np = p + 1;
        let nm = (p % 2 === 0) ? m : Math.floor(m/2);
        let ns = (p % 2 === 0) ? 'p1' : `p${(m%2)+1}`;
        let nextL = document.getElementById(`L_${np}_${nm}_${ns}`);
        if (nextL) nextL.innerText = menang; else document.getElementById('GF_0_0_p2').innerText = menang;
    }
}
jana();
</script>
</body>
</html>
