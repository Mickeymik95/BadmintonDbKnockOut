<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BADMINTON KELUARGA¬≤ SAJA' - SIRI 2</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        :root { 
            --menang: #2ecc71; --kalah: #e74c3c; --utama: #00d2ff; 
            --emas: #ffd700; --perak: #c0c0c0; --gangsa: #cd7f32;
            --bg: #0b0b0d; --kad: #1a1a1f; --garis: #333;
            --glow-emas: 0 0 30px rgba(255, 215, 0, 0.4);
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; padding: 20px; margin: 0; }
        .main-wrapper { display: flex; flex-direction: column; align-items: center; min-width: max-content; padding-bottom: 200px; }

        /* HEADER SECTION */
        .header-container { text-align: center; padding: 60px 20px; width: 100%; }
        .tajuk-box h1 { font-size: 4rem; margin: 0; font-weight: 900; background: linear-gradient(to right, #00d2ff, #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* PODIUM PEMENANG (REKABENTUK CANTIK) */
        #podiumKhas {
            margin-top: 40px;
            padding: 30px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 215, 0, 0.3);
            display: none; /* Hanya muncul bila final selesai */
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            animation: slideUp 0.8s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .podium-title { font-weight: 900; font-size: 1.5rem; margin-bottom: 20px; color: var(--emas); text-transform: uppercase; letter-spacing: 3px; }
        .podium-grid { display: flex; gap: 30px; justify-content: center; align-items: flex-end; }
        
        .pemenang-kad { padding: 20px; border-radius: 15px; background: rgba(0,0,0,0.3); min-width: 180px; position: relative; border-bottom: 5px solid #333; }
        .pemenang-kad.no1 { border-color: var(--emas); transform: scale(1.1); order: 2; background: rgba(255,215,0,0.05); }
        .pemenang-kad.no2 { border-color: var(--perak); order: 1; }
        .pemenang-kad.no3 { border-color: var(--gangsa); order: 3; }

        .medal-icon { font-size: 2.5rem; margin-bottom: 10px; display: block; }
        .pemenang-nama { font-weight: 900; font-size: 1.2rem; display: block; }
        .pemenang-label { font-size: 0.8rem; color: #888; text-transform: uppercase; font-weight: 700; margin-bottom: 5px; display: block; }

        /* BRACKET STYLES */
        .tournament-layout { display: flex; flex-direction: column; gap: 60px; padding: 40px; }
        .laluan-row { display: flex; gap: 40px; padding: 80px 60px; border-radius: 40px; position: relative; background: rgba(255,255,255,0.01); border: 2px solid #333; }
        #barisW { border-color: rgba(0, 210, 255, 0.3); }
        #barisL { border-color: rgba(231, 76, 60, 0.3); }

        .label-bracket { position: absolute; top: -18px; left: 40px; padding: 8px 25px; font-weight: 900; border-radius: 50px; text-transform: uppercase; font-size: 0.9rem; }
        #barisW .label-bracket { background: var(--utama); color: #000; }
        #barisL .label-bracket { background: var(--kalah); color: #fff; }

        .pusingan { display: flex; flex-direction: column; width: 250px; justify-content: center; gap: 30px; }
        .kotak-perlawanan { background: var(--kad); border: 1px solid #333; border-radius: 12px; position: relative; padding-top: 25px; overflow: hidden; }
        .match-no { position: absolute; top: 0; width: 100%; background: #25252b; color: #aaa; font-size: 10px; padding: 4px 0; text-align: center; font-weight: 900; }
        .slot-pasukan { display: flex; gap: 10px; align-items: center; padding: 12px 15px; border-bottom: 1px solid #25252b; }
        .nama-display { flex: 1; font-size: 1rem; font-weight: 700; color: #eee; background: transparent; border: none; outline: none; }
        .skor { width: 40px; height: 35px; text-align: center; background: #000; border: 1px solid #444; color: #fff; border-radius: 6px; font-weight: 900; }

        .pemenang { background: rgba(46, 204, 113, 0.1) !important; }
        .pemenang .nama-display { color: var(--menang); }
        .pemenang .skor { background: var(--menang); color: #000; border-color: var(--menang); }

        .grand-final { border: 2px solid var(--emas) !important; box-shadow: var(--glow-emas); }
        
        .header-actions-grid { display: flex; gap: 10px; margin-top: 20px; justify-content: center; }
        .btn-action { padding: 10px 20px; border-radius: 20px; border: 1px solid #444; background: #111; color: #fff; cursor: pointer; font-weight: 700; font-size: 0.8rem; }
        .admin-only { display: none; }
    </style>
</head>
<body onload="checkPersistentAdmin()">

<div class="main-wrapper">
    <div class="header-container">
        <div class="tajuk-box">
            <h1>BADMINTON KELUARGA¬≤</h1>
            <p style="letter-spacing: 5px; color: #888;">SIRI 2 ‚Ä¢ 2026</p>
        </div>

        <div id="podiumKhas">
            <div class="podium-title">KEPUTUSAN RASMI</div>
            <div class="podium-grid">
                <div class="pemenang-kad no2">
                    <span class="pemenang-label">Naib Juara</span>
                    <span class="medal-icon">ü•à</span>
                    <span class="pemenang-nama" id="res_no2">-</span>
                </div>
                <div class="pemenang-kad no1">
                    <span class="pemenang-label">Juara</span>
                    <span class="medal-icon">ü•á</span>
                    <span class="pemenang-nama" id="res_no1">-</span>
                </div>
                <div class="pemenang-kad no3">
                    <span class="pemenang-label">Tempat Ke-3</span>
                    <span class="medal-icon">ü•â</span>
                    <span class="pemenang-nama" id="res_no3">-</span>
                </div>
            </div>
        </div>

        <div class="header-actions-grid">
            <button class="btn-action" onclick="toggleAdmin()">‚öôÔ∏è ADMIN</button>
            <button class="btn-action admin-only" onclick="saveAll()" style="background:var(--utama); color:#000;">üíæ SIMPAN</button>
            <button class="btn-action admin-only" onclick="logoutAdmin()">üö™ KELUAR</button>
        </div>
    </div>

    <div class="tournament-layout">
        <div id="barisW" class="laluan-row"><div class="label-bracket">Winner Bracket</div></div>
        <div id="barisL" class="laluan-row"><div class="label-bracket">Loser Bracket</div></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBB6Su0uhNcKKoq9Qa_-RGb6cAZOmV2u-U",
        authDomain: "badminton2kalah.firebaseapp.com",
        databaseURL: "https://badminton2kalah-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "badminton2kalah",
        appId: "1:65294297294:web:1664f68c4ffda101cf489f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'tournament_data');

    window.isAdminMode = false;
    window.checkPersistentAdmin = () => {
        if(localStorage.getItem('adminStatus') === 'active') {
            window.isAdminMode = true;
            document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
        }
    };
    window.toggleAdmin = () => {
        let p = prompt("Masukkan Password:");
        if(p === "admin123") { localStorage.setItem('adminStatus', 'active'); location.reload(); }
    };
    window.logoutAdmin = () => { localStorage.removeItem('adminStatus'); location.reload(); };

    onValue(dbRef, (snapshot) => {
        const data = snapshot.val() || {};
        jana(data.teams || {}, data.scores || {});
    });

    window.saveAll = () => {
        let teams = {};
        for(let m=0; m<8; m++){
            teams[`p${m*2}`] = document.getElementById(`W_0_${m}_p1`).value;
            teams[`p${m*2+1}`] = document.getElementById(`W_0_${m}_p2`).value;
        }
        let scores = {};
        document.querySelectorAll('.skor').forEach(s => { if(s.value !== "") scores[s.id] = s.value; });
        set(dbRef, { teams, scores });
    };

    function jana(teams, savedScores) {
        const bw = document.getElementById('barisW'); 
        const bl = document.getElementById('barisL');
        bw.innerHTML = '<div class="label-bracket">Winner Bracket</div>';
        bl.innerHTML = '<div class="label-bracket">Loser Bracket</div>';

        // Bina Bracket
        for(let r=0; r<4; r++) {
            let d = document.createElement('div'); d.className='pusingan';
            for(let m=0; m<Math.pow(2, 3-r); m++) d.appendChild(createBox('W', r, m));
            bw.appendChild(d);
        }
        let gfP = document.createElement('div'); gfP.className='pusingan';
        gfP.appendChild(createBox('GF', 0, 0)); bw.appendChild(gfP);

        const lms = [4,4,2,2,1,1];
        for(let r=0; r<6; r++){
            let d = document.createElement('div'); d.className='pusingan';
            for(let m=0; m<lms[r]; m++) d.appendChild(createBox('L', r, m));
            bl.appendChild(d);
        }

        // Isi Nama Awal
        const sds = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];
        for(let m=0; m<8; m++){
            document.getElementById(`W_0_${m}_p1`).value = teams[`p${m*2}`] || "";
            document.getElementById(`W_0_${m}_p2`).value = teams[`p${m*2+1}`] || "";
        }

        // Load Skor & Kira
        for(let id in savedScores) { if(document.getElementById(id)) document.getElementById(id).value = savedScores[id]; }
        
        const flow = ['W_0','W_1','W_2','W_3','L_0','L_1','L_2','L_3','L_4','L_5','GF_0'];
        flow.forEach(f => {
            document.querySelectorAll(`[id^="${f}_"]`).forEach(box => { if(box.id && box.classList.contains('kotak-perlawanan')) window.kira(box.id); });
        });
        
        penyelarasanLebar();
    }

    function createBox(j, r, m) {
        let id = `${j}_${r}_${m}`;
        let div = document.createElement('div'); div.className = 'kotak-perlawanan'; div.id = id;
        if(j==='GF') div.classList.add('grand-final');
        div.innerHTML = `<div class="match-no">${j}${r+1}-M${m+1}</div>
            <div class="slot-pasukan" id="${id}_s1"><input type="text" class="nama-display" id="${id}_p1" readonly><input type="number" class="skor" id="${id}_sc1" oninput="window.kira('${id}')"></div>
            <div class="slot-pasukan" id="${id}_s2"><input type="text" class="nama-display" id="${id}_p2" readonly><input type="number" class="skor" id="${id}_sc2" oninput="window.kira('${id}')"></div>`;
        return div;
    }

    window.kira = (id) => {
        let s1 = document.getElementById(id+'_sc1').value, s2 = document.getElementById(id+'_sc2').value;
        if(s1 === "" || s2 === "" || s1 === s2) return;
        let w = parseInt(s1) > parseInt(s2) ? 1 : 2;
        let l = w === 1 ? 2 : 1;
        document.getElementById(id+'_s'+w).classList.add('pemenang');
        document.getElementById(id+'_s'+l).classList.remove('pemenang');
        
        let winN = document.getElementById(id+'_p'+w).value;
        let losN = document.getElementById(id+'_p'+l).value;
        let p = id.split('_'), r = parseInt(p[1]), m = parseInt(p[2]);

        if(p[0] === 'W'){
            if(r<3) {
                let target = `W_${r+1}_${Math.floor(m/2)}_p${(m%2)+1}`;
                document.getElementById(target).value = winN;
            } else if(r===3) document.getElementById('GF_0_0_p1').value = winN;
            
            // Drop to Loser
            if(r===0) document.getElementById(`L_0_${Math.floor(m/2)}_p${(m%2)+1}`).value = losN;
            else if(r===1) document.getElementById(`L_1_${3-m}_p2`).value = losN;
            else if(r===2) document.getElementById(`L_3_${1-m}_p2`).value = losN;
            else if(r===3) document.getElementById(`L_5_0_p2`).value = losN;

        } else if(p[0] === 'L'){
            if(r<5){
                if(r%2===0) document.getElementById(`L_${r+1}_${m}_p1`).value = winN;
                else document.getElementById(`L_${r+1}_${Math.floor(m/2)}_p${(m%2)+1}`).value = winN;
            } else { 
                document.getElementById('GF_0_0_p2').value = winN;
                document.getElementById('res_no3').innerText = losN; // Tempat ke-3
            }
        } else if(p[0] === 'GF'){
            document.getElementById('res_no1').innerText = winN; // Juara
            document.getElementById('res_no2').innerText = losN; // Naib Juara
            document.getElementById('podiumKhas').style.display = 'block';
        }
    };

    function penyelarasanLebar() {
        setTimeout(() => {
            const bw = document.getElementById('barisW'); const bl = document.getElementById('barisL');
            const max = Math.max(bw.scrollWidth, bl.scrollWidth);
            bw.style.minWidth = max + "px"; bl.style.minWidth = max + "px";
        }, 100);
    }
</script>
</body>
</html>
