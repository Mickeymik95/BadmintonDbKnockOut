<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Double Elimination - Fixed Cross-Over</title>
<style>
:root{
    --menang:#2ecc71;--kalah:#e74c3c;--utama:#00d2ff;
    --emas:#ffd700;--bg:#0b0b0d;--kad:#1a1a1f;
}
body{
    font-family:'Segoe UI', sans-serif;
    background:var(--bg);color:#fff;margin:0;padding:20px;
}
.kawalan{
    background:var(--kad);padding:15px;border-radius:12px;
    display:flex;gap:10px;align-items:center;justify-content:center;
    position:sticky;top:10px;z-index:99;border:1px solid #333;
    margin-bottom: 30px;
}
button{background:var(--utama);color:#000;font-weight:bold;cursor:pointer;border-radius:6px;padding:8px 15px;border:none;}
button.sec{background:#444;color:#fff}
button:hover{opacity:0.8}

.tournament-layout {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 30px;
    max-width: 1500px;
    margin: 0 auto;
}

.brackets-side { display: flex; flex-direction: column; gap: 80px; }
.laluan-row { display: flex; gap: 40px; padding-bottom: 20px; }
.pusingan { display: flex; flex-direction: column; gap: 20px; min-width: 220px; justify-content: space-around; }

.tajuk-pusingan {
    font-size: .7rem; color: var(--utama); letter-spacing: 1px;
    border-bottom: 2px solid #333; text-align: center; padding-bottom: 5px; margin-bottom: 15px;
}

.kotak-perlawanan {
    background: var(--kad); border: 1px solid #333; border-radius: 8px; overflow: hidden;
}

.id-perlawanan { font-size: .6rem; padding: 4px 10px; background: #25252b; color: #888; border-bottom: 1px solid #333; }

.slot-pasukan {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px; border-bottom: 1px solid #222;
}

input[type=text], .nama-display { flex: 1; border: none; background: transparent; color: #fff; font-size: 0.85rem; outline: none;}
.skor { width: 35px; text-align: center; background: #000; border: 1px solid #444; color: #fff; border-radius: 4px; }

.grand-final-area { display: flex; align-items: center; justify-content: center; }
.grand-final { border: 2px solid var(--emas); box-shadow: 0 0 30px rgba(255, 215, 0, 0.2); width: 280px; }

.teks-menang { color: var(--menang); font-weight: bold; }
.teks-kalah { color: var(--kalah); opacity: 0.5; text-decoration: line-through; }
.skor-menang { background: var(--menang) !important; }
</style>
</head>
<body>

<div class="kawalan">
    <label>Pasukan:</label>
    <input type="number" id="bilPasukan" value="8" step="4" min="4" style="width: 50px; background:#000; color:#fff; border:1px solid #444; padding:5px;">
    <button onclick="jana()">Reset & Jana</button>
    <button class="sec" onclick="autoFill()">Auto-Fill Nama</button>
</div>

<div class="tournament-layout">
    <div class="brackets-side">
        <section>
            <div id="barisW" class="laluan-row"></div>
        </section>
        <section>
            <div id="barisL" class="laluan-row"></div>
        </section>
    </div>
    <div class="grand-final-area">
        <div id="grandFinal"></div>
    </div>
</div>

<script>
function jana() {
    const barisW = document.getElementById('barisW');
    const barisL = document.getElementById('barisL');
    const gfArea = document.getElementById('grandFinal');
    barisW.innerHTML = ''; barisL.innerHTML = ''; gfArea.innerHTML = '';
    
    const n = parseInt(document.getElementById('bilPasukan').value);
    const pLen = Math.ceil(Math.log2(n));

    // Winners Bracket Construction
    for(let p=0; p<pLen; p++) {
        let col = document.createElement('div');
        col.className = 'pusingan';
        col.innerHTML = `<div class="tajuk-pusingan">WINNERS R${p+1}</div>`;
        let matches = Math.pow(2, pLen - p - 1);
        for(let m=0; m<matches; m++) col.appendChild(kotak('W', p, m));
        barisW.appendChild(col);
    }

    // Losers Bracket Construction
    let lTotal = (pLen - 1) * 2;
    for(let p=0; p<lTotal; p++) {
        let col = document.createElement('div');
        col.className = 'pusingan';
        col.innerHTML = `<div class="tajuk-pusingan">LOSERS R${p+1}</div>`;
        let matches = Math.pow(2, Math.floor((lTotal - p - 1) / 2));
        for(let m=0; m<matches; m++) col.appendChild(kotak('L', p, m));
        barisL.appendChild(col);
    }
    gfArea.appendChild(kotak('GF', 0, 0, true));
}

function kotak(j, p, m, gf=false) {
    const id = `${j}_${p}_${m}`;
    let div = document.createElement('div');
    div.className = 'kotak-perlawanan' + (gf ? ' grand-final' : '');
    div.id = id;
    const isW1 = (j === 'W' && p === 0);
    
    div.innerHTML = `
        <div class="id-perlawanan">${gf ? 'ðŸ‘‘ GRAND FINAL' : id.replace('_',' ')}</div>
        <div class="slot-pasukan">
            ${isW1 ? `<input type="text" id="${id}_p1" placeholder="Nama Pasukan">` : `<span id="${id}_p1" class="nama-display">Menunggu...</span>`}
            <input type="number" class="skor" oninput="kemaskini('${id}')">
        </div>
        <div class="slot-pasukan">
            ${isW1 ? `<input type="text" id="${id}_p2" placeholder="Nama Pasukan">` : `<span id="${id}_p2" class="nama-display">Menunggu...</span>`}
            <input type="number" class="skor" oninput="kemaskini('${id}')">
        </div>
    `;
    return div;
}

function kemaskini(id) {
    let box = document.getElementById(id);
    let s = box.querySelectorAll('.skor');
    if (s[0].value === '' || s[1].value === '') return;

    let v1 = parseInt(s[0].value), v2 = parseInt(s[1].value);
    if (v1 === v2) return;

    let n1 = document.getElementById(id + '_p1'), n2 = document.getElementById(id + '_p2');
    let nama1 = n1.value || n1.innerText, nama2 = n2.value || n2.innerText;
    let menang = v1 > v2 ? nama1 : nama2, kalah = v1 > v2 ? nama2 : nama1;

    n1.className = v1 > v2 ? 'teks-menang' : 'teks-kalah';
    n2.className = v2 > v1 ? 'teks-menang' : 'teks-kalah';
    s[0].className = v1 > v2 ? 'skor skor-menang' : 'skor';
    s[1].className = v2 > v1 ? 'skor skor-menang' : 'skor';

    let parts = id.split('_');
    let j = parts[0], p = parseInt(parts[1]), m = parseInt(parts[2]);

    if (j === 'W') {
        // PEMENANG: Ke Winners Round seterusnya atau Grand Final
        let nextW = document.getElementById(`W_${p+1}_${Math.floor(m/2)}_p${(m%2)+1}`);
        if (nextW) nextW.innerText = menang; 
        else document.getElementById('GF_0_0_p1').innerText = menang;

        // KALAH: Ke Losers Bracket dengan Penyilangan (Cross-over)
        let totalMatchesInRound = Math.pow(2, Math.ceil(Math.log2(document.getElementById('bilPasukan').value)) - p - 1);
        
        // Logik Cross-over: pusingan pertama (p=0), kita silangkan m
        let targetM = m;
        if (p === 0) {
            targetM = (m < totalMatchesInRound / 2) ? (m + totalMatchesInRound / 2) : (m - totalMatchesInRound / 2);
        }

        // Cari slot di Losers Bracket
        // W R1 jatuh ke L R1, W R2 jatuh ke L R3, dsb.
        let targetLRound = p * 2;
        let targetSlot = (p === 0) ? (m % 2 === 0 ? 'p1' : 'p2') : 'p1';
        
        // Khusus untuk p=0, kita guna flipped targetM yang dikira tadi
        let finalM = (p === 0) ? Math.floor(targetM / 2) : m;
        let finalSlot = (p === 0) ? `p${(targetM % 2) + 1}` : `p1`;

        let targetLElem = document.getElementById(`L_${targetLRound}_${finalM}_${finalSlot}`);
        if (targetLElem) targetLElem.innerText = kalah;
    } 
    else if (j === 'L') {
        let np = p + 1;
        let nm, ns;
        if (p % 2 === 0) { // Pusingan di mana orang dari Winners masuk
            nm = m; ns = 'p2';
        } else { // Pusingan pemenang Loser lawan pemenang Loser
            nm = Math.floor(m/2); ns = `p${(m%2)+1}`;
        }
        let nextL = document.getElementById(`L_${np}_${nm}_${ns}`);
        if (nextL) nextL.innerText = menang; 
        else document.getElementById('GF_0_0_p2').innerText = menang;
    }
}

function autoFill() {
    const inputs = document.querySelectorAll('input[id^="W_0_"]');
    const names = ["Naga V1", "Harimau Malaya", "Elang Putih", "Garuda", "Sang Kancil", "Seladang", "Tupai", "Landak"];
    inputs.forEach((inp, i) => {
        inp.value = names[i] || "Pasukan " + (i + 1);
    });
}

jana();
</script>
</body>
</html>
